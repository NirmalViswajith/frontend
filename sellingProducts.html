<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <div>
      <form id="productForm">
        <label for="productName">Product Name:</label>
        <input type="text" name="productName" id="productName" />
        <label for="sellingPrice">Selling Price:</label>
        <input type="number" name="sellingPrice" id="sellingPrice" />
        <label for="items">Choose a category: </label>
        <select name="items" id="items">
          <option value="ElectronicItems">Electronic Items</option>
          <option value="FoodItems">Food Items</option>
          <option value="SkincareItems">Skincare Items</option>
        </select>
        <input type="button" id="addProduct" value="Add Product" />
      </form>
    </div>
    <hr />
    <div>
      <h3>Electronic Items</h3>
      <ul id="electronicItems"></ul>
      <h3>Food Items</h3>
      <ul id="foodItems"></ul>
      <h3>Skincare Items</h3>
      <ul id="skincareItems"></ul>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
      async function fetchProducts() {
        try {
          const response = await axios.get(
            "https://crudcrud.com/api/f171d97e97bf48d59331382e5fdf9743/products"
          );
          const products = response.data;
          const categoryLists = {
            ElectronicItems: document.getElementById("electronicItems"),
            FoodItems: document.getElementById("foodItems"),
            SkincareItems: document.getElementById("skincareItems"),
          };
          for (const product of products) {
            const listItem = createListItem(product);
            categoryLists[product.category].appendChild(listItem);
          }
        } catch (error) {
          console.error("Error fetching products:", error);
        }
      }
      function createListItem(product) {
        const listItem = document.createElement("li");
        listItem.textContent = `${product.productName} - $${product.sellingPrice}`;

        const deleteButton = document.createElement("button");
        deleteButton.textContent = "Delete";
        deleteButton.addEventListener("click", async () => {
          try {
            await deleteProduct(product._id);
            listItem.remove(); // Remove the list item from the screen
            console.log("Product deleted:", product._id);
          } catch (error) {
            console.error("Error deleting product:", error);
          }
        });

        listItem.appendChild(deleteButton);
        return listItem;
      }
      async function deleteProduct(productId) {
        await axios.delete(
          `https://crudcrud.com/api/f171d97e97bf48d59331382e5fdf9743/products/${productId}`
        );
      }

      document.addEventListener("DOMContentLoaded", () => {
        fetchProducts();
      });

      document
        .getElementById("addProduct")
        .addEventListener("click", async (event) => {
          event.preventDefault(); // Prevent form submission
          const category = document.getElementById("items").value;
          const productName = document.getElementById("productName").value;
          const sellingPrice = document.getElementById("sellingPrice").value;
          const product = {
            category: category,
            productName: productName,
            sellingPrice: sellingPrice,
          };
          try {
            await axios.post(
              "https://crudcrud.com/api/f171d97e97bf48d59331382e5fdf9743/products",
              product
            );
            console.log("Product added:", product);
            const listItem = createListItem(product);
            const categoryList = document.getElementById(
              `${category.toLowerCase()}Items`
            );
            categoryList.appendChild(listItem);
            document.getElementById("productName").value = "";
            document.getElementById("sellingPrice").value = "";
          } catch (error) {
            console.error("Error adding product:", error);
          }
        });
    </script>
  </body>
</html>
